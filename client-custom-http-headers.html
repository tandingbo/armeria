

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Sending custom HTTP headers &mdash; Armeria 0.64.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/overrides.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Automatic retry" href="client-retry.html" />
    <link rel="prev" title="Decorating a client" href="client-decorator.html" />
  <script src="_static/center_page.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
   


  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html">
          

          
            
            <img src="_static/armeria.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.64
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setting up a project</a></li>
<li class="toctree-l1"><a class="reference internal" href="server.html">Writing a server</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="client.html">Writing a client</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="client-http.html">Calling an HTTP service</a></li>
<li class="toctree-l2"><a class="reference internal" href="client-retrofit.html">Retrofit integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="client-thrift.html">Calling a Thrift service</a></li>
<li class="toctree-l2"><a class="reference internal" href="client-grpc.html">Calling a gRPC service</a></li>
<li class="toctree-l2"><a class="reference internal" href="client-decorator.html">Decorating a client</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Sending custom HTTP headers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#using-clients-withhttpheaders">Using <tt class="docutils literal">Clients.withHttpHeaders()</tt></a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-clientoption-http-headers">Using <tt class="docutils literal">ClientOption.HTTP_HEADERS</tt></a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-clientbuilder-decorator">Using <tt class="docutils literal">ClientBuilder.decorator()</tt></a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-a-derived-client">Using a derived client</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="client-retry.html">Automatic retry</a></li>
<li class="toctree-l2"><a class="reference internal" href="client-circuit-breaker.html">Circuit breaker</a></li>
<li class="toctree-l2"><a class="reference internal" href="client-service-discovery.html">Client-side load balancing and service discovery</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">Advanced topics</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/line/armeria/releases">Release notes</a></li>
<li class="toctree-l1"><a class="reference external" href="apidocs/index.html#://">API documentation</a></li>
<li class="toctree-l1"><a class="reference external" href="xref/index.html#://">Source cross-reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/line/armeria/issues?q=label%3Aquestion-answered">Questions and answers</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/line/armeria">Fork me at GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/line/armeria/blob/master/CONTRIBUTING.md">Contributing</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Armeria</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="client.html">Writing a client</a> &raquo;</li>
        
      <li>Sending custom HTTP headers</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/line/armeria/blob/master/site/src/sphinx/client-custom-http-headers.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="sending-custom-http-headers">
<span id="client-custom-http-headers"></span><h1>Sending custom HTTP headers<a class="headerlink" href="#sending-custom-http-headers" title="Permalink to this headline">¶</a></h1>
<p>When send an RPC request, it is sometimes required to send HTTP headers with it, such as authentication token.
There are four ways to customize the HTTP headers of your RPC request:</p>
<ul class="simple">
<li>Using the <tt class="docutils literal">Clients.withHttpHeaders()</tt> method</li>
<li>Using the <tt class="docutils literal">ClientOption.HTTP_HEADERS</tt> option</li>
<li>Using the <tt class="docutils literal">ClientBuilder.decorator()</tt> method</li>
<li>Using a derived client</li>
</ul>
<div class="section" id="using-clients-withhttpheaders">
<h2>Using <tt class="docutils literal">Clients.withHttpHeaders()</tt><a class="headerlink" href="#using-clients-withhttpheaders" title="Permalink to this headline">¶</a></h2>
<div class="highlight-java notranslate"><div class="highlight hljs"><pre class="java">import static com.linecorp.armeria.common.HttpHeaderNames.AUTHORIZATION;
import com.linecorp.armeria.common.util.SafeCloseable
import com.linecorp.armeria.client.Clients;

HelloService.Iface client = Clients.newClient(&quot;tbinary+http://example.com/hello&quot;,
                                               HelloService.Iface.class);
try (SafeCloseable ignored = Clients.withHttpHeaders(
        headers -&gt; headers.set(AUTHORIZATION, credential))) {
    client.hello(&quot;authorized personnel&quot;);
}</pre></div>
</div>
<p>If you are setting only a single header, you can use <tt class="docutils literal">Clients.withHttpHeader()</tt> simply:</p>
<div class="highlight-java notranslate"><div class="highlight hljs"><pre class="java">try (SafeCloseable ignored = Clients.withHttpHeader(AUTHORIZATION, credential)) {
    client.hello(&quot;authorized personnel&quot;);
}</pre></div>
</div>
<p>You can also nest <tt class="docutils literal">withHttpHeader(s)</tt>. The following example will send both <tt class="docutils literal">user-agent</tt> header and
<tt class="docutils literal">authorization</tt> header when calling <tt class="docutils literal">client.hello()</tt>:</p>
<div class="highlight-java notranslate"><div class="highlight hljs"><pre class="java">import static com.linecorp.armeria.common.HttpHeaderNames.USER_AGENT;

try (SafeClosedble ignored1 = Clients.withHttpHeader(USER_AGENT, myUserAgent)) {
    for (String cred : credentials) {
        try (SafeCloseable ignored2 = Clients.withHttpHeaders(AUTHORIZATION, cred)) {
            client.hello(&quot;authorized personnel&quot;);
        }
    }
}</pre></div>
</div>
</div>
<div class="section" id="using-clientoption-http-headers">
<h2>Using <tt class="docutils literal">ClientOption.HTTP_HEADERS</tt><a class="headerlink" href="#using-clientoption-http-headers" title="Permalink to this headline">¶</a></h2>
<p>If you have a custom HTTP header whose value does not change often, you can use <tt class="docutils literal">ClientOption.HTTP_HEADERS</tt>
which is more efficient:</p>
<div class="highlight-java notranslate"><div class="highlight hljs"><pre class="java">import static com.linecorp.armeria.common.HttpHeaderNames.AUTHORIZATION;
import com.linecorp.armeria.common.HttpHeaders;
import com.linecorp.armeria.client.ClientBuilder;
import com.linecorp.armeria.client.ClientOption;

ClientBuilder cb = new ClientBuilder(&quot;tbinary+http://example.com/hello&quot;);
cb.setHttpHeader(AUTHORIZATION, credential);
// or:
// cb.option(ClientOption.HTTP_HEADERS, HttpHeaders.of(AUTHORIZATION, credential));
HelloService.Iface client = cb.build(HelloService.Iface.class);
client.hello(&quot;authorized personnel&quot;);</pre></div>
</div>
</div>
<div class="section" id="using-clientbuilder-decorator">
<h2>Using <tt class="docutils literal">ClientBuilder.decorator()</tt><a class="headerlink" href="#using-clientbuilder-decorator" title="Permalink to this headline">¶</a></h2>
<p>If you want more freedom on how you manipulate the request headers, use a decorator:</p>
<div class="highlight-java notranslate"><div class="highlight hljs"><pre class="java">ClientBuilder cb = new ClientBuilder(&quot;tbinary+http://example.com/hello&quot;);

// Add a decorator that inserts the custom header.
cb.decorator(HttpRequest.class, HttpResponse.class,
             (delegate, ctx, req) -&gt; { // See DecoratingClientFunction.
                 req.headers().set(AUTHORIZATION, credential);
                 return delegate.execute(ctx, req);
             });

HelloService.Iface client = cb.build(HelloService.Iface.class);
client.hello(&quot;authorized personnel&quot;);</pre></div>
</div>
<p>Note that this method is as efficient as the <tt class="docutils literal">ClientOption.HTTP_HEADERS</tt> option. Choose whichever you prefer.</p>
</div>
<div class="section" id="using-a-derived-client">
<h2>Using a derived client<a class="headerlink" href="#using-a-derived-client" title="Permalink to this headline">¶</a></h2>
<p>Although not as simple as using <tt class="docutils literal">withHttpHeaders()</tt>, you can create a derived client to add more custom
headers to an existing client:</p>
<div class="highlight-java notranslate"><div class="highlight hljs"><pre class="java">import com.linecorp.armeria.client.ClientOptionsBuilder;

HelloService.Iface client = ...;
HelloService.Iface derivedClient = Clients.newDerivedClient(client, options -&gt; {
    ClientOptionsBuilder builder = new ClientOptionsBuilder(options);
    builder.decorator(...);  // Add a decorator.
    builder.httpHeader(AUTHORIZATION, credential); // Add an HTTP header.
    return builder.build();
});</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="client-retry.html" class="btn btn-neutral float-right" title="Automatic retry" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="client-decorator.html" class="btn btn-neutral" title="Decorating a client" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015-2018, LINE Corporation.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.64.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script>
  <div class="github-fork-ribbon-wrapper right">
    <div class="github-fork-ribbon">
      <a href="https://github.com/line/armeria">Fork me at GitHub</a>
    </div>
  </div>
  <script type="text/javascript" src="_static/add_badges.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.3.0/highlightjs-line-numbers.min.js"></script>
  <script>
    document.querySelectorAll('div.hljs > pre').forEach(function(block) {
      hljs.highlightBlock(block);
      hljs.lineNumbersBlock(block);
    });
  </script>
   


</body>
</html>